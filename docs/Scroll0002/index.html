<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style> body { margin: 0; } </style>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <!-- bgcolor="#212226" -->
    <!-- style="overflow: hidden;" -->
    <!-- <div id="headers">
        <h1 class="header1">Украина и республики</h1>
    </div> -->

    <button id="go">go</button>
    <button id="back">back</button>

    <div id="graphic">
        <div id="chartArea" >
            <script>
                function getColor(v, c) {
                    if (4>v && v>=0){
                        if (c=="ukr") {
                            return "#ffed26";
                        } else {
                            return "#8cffff";
                        }
                    } else if (8>v && v>=4){
                        if (c=="ukr") {
                            return "#fbbf00";
                        } else {
                            return "#5ed9ea";
                        }
                    } else if (13>v && v>=8){
                        if (c=="ukr") {
                            return "#ee9100";
                        } else {
                            return "#35b2d4";
                        }
                    } else if (22>v && v>=13){
                        if (c=="ukr") {
                            return "#da6513";
                        } else {
                            return "#108dba";
                        }
                    } else if (v>=22){
                        if (c=="ukr") {
                            return "#bf381d";
                        } else {
                            return "#00689c";
                        }
                    }
                };

                var bandWidth;
                var wurstH = 30;
                var NFS = 250;

                const W = document.getElementById('chartArea').clientWidth,
                    H = document.getElementById('chartArea').clientHeight;

                var margin = {
                        top: W*0.15, 
                        bottom: H*0.1, 
                        right: W*0.03,
                        left: W*0.03
                        },
                    width = W - margin.left - margin.right,
                    height = H - margin.top - margin.bottom;

                var x = d3.scaleTime().range([0, width]);
                var y = d3.scaleLinear().range([height, 0]);

                var xAxis = d3.axisBottom(x).tickSize(0);
                var yAxis = d3.axisLeft(y).tickSize(0);

                var svg = d3.select("#chartArea").append("svg")
                        .attr("width", W)
                        .attr("height", H)
                        .append("g")   

                svg.append("defs").append("clipPath")
                        .attr("id", "clip")
                    .append("rect")
                        .attr("width", width)
                        .attr("height", H);

                var focus = svg.append("g")
                    .attr("class", "focus")
                    .attr("width", width-margin.left-margin.right)
                    .attr("height", H)
                    .attr(
                        "transform", 
                        "translate(" + margin.left + "," + margin.top + ")"
                        );
                
                var parseTime = d3.timeParse("%Y-%m-%d");
                
                d3.csv("vio_ukr_resp.csv").then( function(data) {

                    data.forEach(function(d) {
                        d.date = parseTime(d.date);
                    });

                    var xMin = d3.min(data, function(d) { return d.date; });
                    var xMax = d3.max(data, function(d) { return d.date; });

                    x.domain([xMin, xMax]);
                    y.domain([0, 400]);

                    focus.append("g")
                        .attr("opacity", 0)
                        .attr("id", "X")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis);

                    focus.append("g")
                        .attr("opacity", 0)
                        .call(yAxis);
                    
                    line1 = d3.line()
                        .curve(d3.curveStep)
                        .x(d => x(d.date))
                        .y(d => y(d["ukr"]));

                    focus.append("path")
                        .datum(data)
                        .attr("clip-path", "url(#clip)")
                        .attr("id", "l1")
                        .attr("fill", "none")
                        .attr("stroke", "#fbbf00")
                        .attr("stroke-width", 1.2)
                        .attr("stroke-linejoin", "round")
                        .attr("stroke-linecap", "round")
                        .attr("d", line1);

                    line2 = d3.line()
                        .curve(d3.curveStep)
                        .x(d => x(d.date))
                        .y(d => y(d["resp"]));

                    focus.append("path")
                        .datum(data)
                        .attr("clip-path", "url(#clip)")
                        .attr("id", "l2")
                        .attr("fill", "none")
                        .attr("stroke", "#00ace5")
                        .attr("stroke-width", 1.2)
                        .attr("stroke-linejoin", "round")
                        .attr("stroke-linecap", "round")
                        .attr("d", line2);

                    function cleaner(path, c) {
                        path
                        .transition()
                        .duration(400)
                        .attr("d", d3.line()
                            .curve(d3.curveStep)
                            .x(function(d) { return x(d.date) })
                            .y(function(d) { return y(d[c]) })
                    )};

                    function cleaned(a, b) {
                        var s = Array(a, b);
                        x.domain(s);
                        focus.select("#l1").call(cleaner, "ukr");
                        focus.select("#l2").call(cleaner, "resp");
                        focus.select("#X").transition().duration(400).call(d3.axisBottom(x).tickSize(0));
                    };

                    var B1 = d3.select("#go");
                    B1.on('click', function() { cleaned(parseTime("2018-05-16"), parseTime("2018-10-01")); });

                    var B2 = d3.select("#back");
                    B2.on('click', function() { cleaned(xMin, xMax); });

                });

            </script>
        </div>
    </div>
</body>