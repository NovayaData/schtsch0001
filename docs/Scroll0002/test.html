<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style> body { margin: 0; } </style>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <!-- bgcolor="#212226" -->
    <!-- style="overflow: hidden;" -->
    <div id="headers">
        <h1 class="header1">Украина и республики</h1>
    </div>

    <div id="graphic">
        <div id="chartArea" >
            <script>

                function getColor(v, c) {
                    if (4>v && v>=0){
                        if (c=="ukr") {
                            return "#ffed26";
                        } else {
                            return "#8cffff";
                        }
                    } else if (8>v && v>=4){
                        if (c=="ukr") {
                            return "#fbbf00";
                        } else {
                            return "#5ed9ea";
                        }
                    } else if (13>v && v>=8){
                        if (c=="ukr") {
                            return "#ee9100";
                        } else {
                            return "#35b2d4";
                        }
                    } else if (22>v && v>=13){
                        if (c=="ukr") {
                            return "#da6513";
                        } else {
                            return "#108dba";
                        }
                    } else if (v>=22){
                        if (c=="ukr") {
                            return "#bf381d";
                        } else {
                            return "#00689c";
                        }
                    }
                };

                var bandWidth;
                var wurstH = 30;
                var NFS = 250;

                const W = document.getElementById('chartArea').clientWidth,
                    H = document.getElementById('chartArea').clientHeight;

                var margin = {
                        top: W*0.03, 
                        bottom: H*0.1, 
                        right: W*0.03,
                        left: W*0.03, 
                        // top2: 500, 
                        // bottom2: 100
                        },
                    width = W - margin.left - margin.right,
                    height = H - margin.top - margin.bottom;
                    // height2 = wurstH*2;

                var x = d3.scaleTime().range([0, width]);
                var y = d3.scaleLinear().range([height, 0]);
                    // x2 = d3.scaleTime().range([0, width]),
                    // x3 = d3.scaleTime().range([0, width]),
                    
                    // y2 = d3.scaleLinear().range([height2, 0]);
                    // y3 = d3.scaleLinear().range([height2, 0]);

                var xAxis = d3.axisBottom(x).tickSize(5);
                var yAxis = d3.axisLeft(y).tickSize(5);
                    // xAxis2 = d3.axisBottom(x2).tickSize(5),
                    // xAxis3 = d3.axisBottom(x3).tickSize(5),
                    // yAxis2 = d3.axisLeft(y2).tickSize(5),
                    // yAxis3 = d3.axisLeft(y3).tickSize(5);

                // var brush = d3.brushX()
                //     .extent([[0, 0], [width, height2*2]])
                //     .on("brush", brushed);

                var svg = d3.select("#chartArea").append("svg")
                        .attr("width", W)
                        .attr("height", H)
                        .append("g")   

                svg.append("defs").append("clipPath")
                        .attr("id", "clip")
                    .append("rect")
                        .attr("width", W)
                        .attr("height", H);

                var focus = svg.append("g")
                    .attr("class", "focus")
                    .attr("width", width)
                    .attr("height", height)
                    .attr(
                        "transform", 
                        "translate(" + margin.left + "," + margin.top + ")"
                        );
                
                // var context1 = svg.append("g")
                //     .attr("class", "context")
                //     .attr("width", width)
                //     .attr("height", height2)
                //     .attr("transform", 
                //         "translate(" + margin.left + "," + margin.top2 + ")");

                // let context2H = margin.top2 + height2;
                
                // var context2 = svg.append("g")
                //     .attr("class", "context")
                //     .attr("width", width)
                //     .attr("height", height2)
                //     .attr(
                //         "transform", 
                //         "translate(" + margin.left + "," + context2H + ")");
                
                var parseTime = d3.timeParse("%Y-%m-%d");
                
                d3.csv("vio_ukr_resp.csv").then( function(data) {

                    data.forEach(function(d) {
                        d.date = parseTime(d.date);
                    });

                    var xMin = d3.min(data, function(d) { return d.date; });
                    var xMax = d3.max(data, function(d) { return d.date; });
                    // var yMax = d3.max(data, function(d) { return d["ukr"]; });

                    x.domain([xMin, xMax]);
                    y.domain([0, 100]);
                    // Y MAX
                    // x2.domain(x.domain());
                    // x3.domain(x.domain());
                    // y2.domain(y.domain());

                    // var bars1 = context1.append("g");
                    // var bars2 = context2.append("g");

                    // bandWidth = width/data.length;

                    // function createHitLine(path, x, y, height, weeksum) {
                    //     path.attr("clip-path", "url(#clip)");
                    //     path.selectAll("bar")
                    //         .data(data)
                    //         .enter().append("rect")
                    //             // .attr("class", function(d) { return "b"+d.episode; })
                    //             // .attr("id", function(d) { return d.day; })
                    //             .attr("x", d => { return x(d.date); })
                    //             .attr("width", bandWidth)
                    //             .attr("y", height-wurstH)
                    //             .attr("height", wurstH)
                    //             .attr("opacity", 1)
                    //             .attr("fill", function(d) {console.log(d[weeksum]); return getColor(d[weeksum]); });
                    // };

                    // bars1.attr("clip-path", "url(#clip)");
                    // bars1.selectAll("bar")
                    //     .data(data)
                    //     .enter().append("rect")
                    //         // .attr("class", function(d) { return "b"+d.episode; })
                    //         // .attr("id", function(d) { return d.day; })
                    //         .attr("x", d => { return x2(d.date); })
                    //         .attr("width", bandWidth)
                    //         .attr("y", height2-wurstH)
                    //         .attr("height", wurstH)
                    //         .attr("opacity", 1)
                    //         .attr("fill", function(d) { return getColor(d["ukr"], "ukr"); });

                    // bars2.attr("clip-path", "url(#clip)");
                    // bars2.selectAll("bar")
                    //     .data(data)
                    //     .enter().append("rect")
                    //         // .attr("class", function(d) { return "b"+d.episode; })
                    //         // .attr("id", function(d) { return d.day; })
                    //         .attr("x", d => { return x3(d.date); })
                    //         .attr("width", bandWidth)
                    //         .attr("y", height2-wurstH)
                    //         .attr("height", wurstH)
                    //         .attr("opacity", 1)
                    //         .attr("fill", function(d) { return getColor(d["resp"], "resp"); });

                    // bars1.call(createHitLine, x2, y2, height2, "ukr");
                    // bars2.call(createHitLine, x3, y3, height2, "resp");

                    // function createHitLine(path, xA, yA, height) {
                    //     path.append("g")
                    //         .attr("class", "axis x-axis")
                    //         // .attr("fill", "#000000")
                    //         .attr("transform", "translate(0," + height + ")")
                    //         .call(xA);

                    //     path.append("g")
                    //         .attr("class", "axis axis--y")
                    //         .call(yA);
                    // };

                    // context1.call(createHitLine, xAxis2, yAxis2, height2);
                    // context2.call(createHitLine, xAxis3, yAxis3, height2);

                    line1 = d3.line()
                        // .defined(d => !isNaN(d.value))
                        .x(d => x(d.date))
                        .y(d => y(d["ukr"]));

                    focus.append("path")
                        .datum(data)
                        .attr("fill", "none")
                        .attr("stroke", "#fbbf00")
                        .attr("stroke-width", 1)
                        .attr("stroke-linejoin", "round")
                        .attr("stroke-linecap", "round")
                        .attr("d", line1);

                    line2 = d3.line()
                        // .defined(d => !isNaN(d.value))
                        .x(d => x(d.date))
                        .y(d => y(d["resp"]));

                    focus.append("path")
                        .datum(data)
                        .attr("fill", "none")
                        .attr("stroke", "#00ace5")
                        .attr("stroke-width", 1)
                        .attr("stroke-linejoin", "round")
                        .attr("stroke-linecap", "round")
                        .attr("d", line2);

                    // context2.append("g")
                    //         .attr("class", "brush")
                    //         .call(brush)
                    //         .call(brush.move, x.range());

                });

            </script>
        </div>
    </div>
</body>